<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0" />
		<title>加载中</title>


		<!-- <link rel="stylesheet" href="../css/wx_example.css" /> -->
		<!-- <link rel="stylesheet" href="../css/weui.css" /> -->
		<link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.0/style/weui.min.css" />
		<link rel="stylesheet" href="../css/sandoz.css" />
	</head>

	<body ontouchstart>
		<div class="container js_container">
			<div class="page">


				<div class="loading-box">
					<img src="../img/walking.gif" alt="">
					<p>数据加载中，请稍候...</p>
				</div>


			</div>
		</div>

		<!--js-->
		<!--<script type="text/javascript" src="../js/config.js" ></script>
		<script type="text/javascript" src="../js/libs/interface.js" ></script>-->
		<script src="https://res.wx.qq.com/open/libs/zepto/1.1.6/zepto.js"></script>
		<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
		<script src="../js/libs/public-utils.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/api.js"></script>
		<!--<script type="text/javascript" src="http://code.changer.hk/jquery/1.11.2/jquery.min.js"></script>-->
		<!--<script type="text/javascript" src="http://code.changer.hk/jquery/plugins/jquery.cookie.js"></script>-->
		<!-- <script src="../js/libs/wx_example.js"></script> -->
		<script>

			$(function(){
				var code = getQueryString("code");
//				alert("code:"+code);
				if(code){
					Api.getFirstRedirectUrl(code ,
						function(data) {
							console.log('获取数据成功');
							console.log(data);
//							alert(JSON.stringify(data));
							if(data) {
								var homepageUrl = data.homepageUrl;
								var token = data.token;
								var openId = data.openId;
								if(token) {
//									saveCookie("token" ,token);
									setCookie("token" ,token ,31);
								}
								if(openId) {
//									saveCookie("openId" ,openId);
									setCookie("openId" ,openId ,31);
								}
								window.location.href = homepageUrl;
							}
						},
						function(error) {
							alert(JSON.stringify(error));
							console.log('获取数据失败');
							console.log(error);
						}
					)
				}else{
					alert(2);
					Api.getRedirectUrlByToken(
							function (data) {
								console.log('获取数据成功');
								console.log(data);
								if(data) {
									var token = data.token;
//									alert("isok:"+token);
									var openId = data.openId;
									if(token) {
//										saveCookie("token" ,token);
										setCookie("token" ,token ,31);
									}
									if(openId) {
//										saveCookie("openId" ,openId);
										setCookie("openId" ,openId ,31);
									}
									var homepageUrl = data.homepageUrl;
									if(homepageUrl) {
										window.location.href = homepageUrl;
									}
								}
							},
							function (error) {
								console.log('获取数据失败');
								console.log(error);
//								alert(error);
//								alert(JSON.stringify(error));
								window.location.href= wechatConfig.wechatOauthUrl + "?appid=" + wechatConfig.appid + "&redirect_uri=http://" + config.server + "/sandoz-wx/sales_representative/loading.html&response_type=code&scope=" + wechatConfig.scope + "#wechat_redirect";
							}
					);
				}
			});

//			function saveCookie(param ,data) {
//				$.cookie(param, data, {
//					expires: 31,
//					path: "/"
//				});
//			};


		</script>
	</body>
</html>
